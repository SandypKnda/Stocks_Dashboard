<!DOCTYPE html>
<html>

<head>
  <title>Stock Treemap Dashboard</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2>📈 Today's Top Stocks by Sector</h2>
  <div id="treemap"></div>
  <script>
    fetch('/api/stocks')
      .then(res => res.json())
      .then(data => {
        console.log("📊 STOCK DATA:", data);  // <== NEW LINE

        if (!data || data.length === 0) {
          document.getElementById("treemap").innerHTML = "⚠️ No valid stock data found.";
          return;
        }
        
        const labels = data.map(d => `${d.symbol} ($${d.price})`);
        const parents = data.map(d => d.sector || "Other");
        const values = data.map(d => d.price);
        const custom = data.map(d => `Predicted EOD: $${d.eod_prediction}`);

        const trace = {
          type: "treemap",
          labels: labels,
          parents: parents,
          values: values,
          textinfo: "label+value",
          hovertext: custom,
          hoverinfo: "text"
        };

        Plotly.newPlot('treemap', [trace]);
      });
      .catch(err => {
        console.error("❌ Error loading stock data:", err);
        document.getElementById("treemap").innerHTML = "⚠️ Error loading stock data.";
      });
  </script>
</body>
</html>

